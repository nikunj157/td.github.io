<!DOCTYPE html>
<meta charset="utf-8">
<head>
<title>JoinIg Page</title>
<script>
function joinIg(event) {
	var result_container = document.getElementById('result');
  var result_text = '<h1>Result</h1>';  
  var ig_owner = document.getElementById('owner').value;
  var num_igs = document.getElementById('count').value;
  
  if (!navigator.joinAdInterestGroup) {
    result_text += "Turtledove not enabled. Please use dev version of Chrome with right flags. Run this:</br></br>";
    result_text += "  google-chrome-unstable --enable-features=kFledgeInterestGroups,kFledgeInterestGroupAPI,FledgeInterestGroups,FledgeInterestGroupAPI</br>";
  } else {
    for (let i = 0; i < num_igs; i++) {
     let ig_name = "interest-group-" + i;
     try {
        let ig = {
          owner: ig_owner,
          name: ig_name,
          biddingLogicUrl: "https://nikunj157.github.io/td.github.io/scripts/bid_logic_url.js",
          userBiddingSignals: {},
          ads: [
            {
              renderUrl: "https://nikunj157.github.io/td.github.io/scripts/adg1.html",
              metadata: {
                bid: 1
              },
            },
            {
              renderUrl: "https://nikunj157.github.io/td.github.io/scripts/adg2.html",
              metadata: {
                bid: 2
              },
            },
            {
              renderUrl: "https://nikunj157.github.io/td.github.io/scripts/adg3.html",
              metadata: {
                bid: 3
              },
            },
          ],
        };
        navigator.joinAdInterestGroup(ig, 10000);
        result_text += "joined interest group:" + ig.name + ":</br>" + JSON.stringify(ig) + "</br></br>";
      } catch (error) {
      	result_text += "<br/> Error for " + ig_name + "<br/>";
        result_text += error;
      }
    }
  }
  result_container.innerHTML += result_text;
  return false;
}
</script>
</head>
<body>
<h1>Please enter following IG attributes & press Submit.</h1>
<form id="ig_form" onsubmit="return false;">
  <label for="owner">IG Owner:</label>
  <input type="text" id="owner" name="IG Owner" value='https://nikunja.users.x20web.corp.google.com/' size="100"><br><br>
  <label for="count">Number of IGs to join:</label>
  <input type="text" id="count" name="Number of IGs" value='1'><br><br>  
  <input type="submit" value="Submit" onclick="joinIg();">
</form>
<div id="result">
</div>
</body>
</html>
